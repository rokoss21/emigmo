# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å–æ –∑–≤–æ–Ω–∫–∞–º–∏ –≤ Enigmo

## üö® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å IncomingCallHandler**
**–ü—Ä–æ–±–ª–µ–º–∞:** `IncomingCallHandler` –±—ã–ª —Ä–∞–∑–º–µ—â–µ–Ω —Ç–æ–ª—å–∫–æ –≤ `SplashScreen`, –ø–æ—ç—Ç–æ–º—É —É–Ω–∏—á—Ç–æ–∂–∞–ª—Å—è –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `builder` –≤ `MaterialApp`.

### 2. **–ü—Ä–æ–±–ª–µ–º—ã –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –≤–∏–¥–∂–µ—Ç–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** `setState() called after dispose()` –≤ `AudioCallScreen`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `mounted` –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ `setState()`.

### 3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebRTC**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è STUN —Å–µ—Ä–≤–µ—Ä–æ–≤.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ STUN —Å–µ—Ä–≤–µ—Ä—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π WebRTC.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### WebRTC Configuration
```dart
final configuration = {
  'iceServers': [
    {'urls': 'stun:stun.l.google.com:19302'},
    {'urls': 'stun:stun1.l.google.com:19302'},
    {'urls': 'stun:stun2.l.google.com:19302'},
  ],
  'iceTransportPolicy': 'all',
  'bundlePolicy': 'max-bundle',
  'rtcpMuxPolicy': 'require',
  'sdpSemantics': 'unified-plan',
  if (kIsWeb) 'encodedInsertableStreams': true,
};
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∑–≤–æ–Ω–∫–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
- –£–ª—É—á—à–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ (echo cancellation, noise suppression)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Chrome
flutter run -d chrome --web-port=3000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Firefox
flutter run -d web-server --web-port=3001
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3001 –≤ Firefox
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Chrome Incognito
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –û–±—ã—á–Ω—ã–π Chrome
flutter run -d chrome --web-port=3000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Chrome Incognito
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000 –≤ —Ä–µ–∂–∏–º–µ Incognito
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –∏—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- `DEBUG AudioCallService.*` - –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ –∑–≤–æ–Ω–∫–æ–≤
- `WebRTC Connection state changed` - —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `ICE Connection state changed` - —Å–æ—Å—Ç–æ—è–Ω–∏—è ICE

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ–¥–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã 8081 (—Å–µ—Ä–≤–µ—Ä) –∏ 3000/3001 (–∫–ª–∏–µ–Ω—Ç—ã) –¥–æ—Å—Ç—É–ø–Ω—ã

## üìã –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ IncomingCallHandler** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≤–∏–¥–∂–µ—Ç–æ–≤** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ **WebRTC –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —É–ª—É—á—à–µ–Ω–æ
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —É–ª—É—á—à–µ–Ω–æ
- ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞** - –¥–æ–±–∞–≤–ª–µ–Ω–æ

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –í—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–º —ç–∫—Ä–∞–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –ù–µ –±—É–¥–µ—Ç –æ—à–∏–±–æ–∫ `setState() called after dispose()`
3. –õ—É—á—à–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —á–µ—Ä–µ–∑ –ª–æ–≥–∏
4. –ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
5. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å –¥–≤—É–º—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. **–£–±–µ–¥–∏—Ç–µ—Å—å** –≤ –Ω–∞–ª–∏—á–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –∑–≤–æ–Ω–∫–∏ –º–µ–∂–¥—É —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏

### **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ—è:**
1. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ** `PRODUCTION_DEPLOYMENT.md` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS –∏ TURN —Å–µ—Ä–≤–µ—Ä–∞
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ TURN —Å–µ—Ä–≤–µ—Ä** (coturn)
4. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –∫–ª–∏–µ–Ω—Ç–∞ —Å –≤–∞—à–∏–º–∏ TURN —Å–µ—Ä–≤–µ—Ä–∞–º–∏
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

## ‚ö†Ô∏è **–í–ê–ñ–ù–û –î–õ–Ø –ü–†–û–î–ê–ö–®–ù–ê**

–ë–µ–∑ HTTPS –∏ TURN —Å–µ—Ä–≤–µ—Ä–∞ –∑–≤–æ–Ω–∫–∏ **–ù–ï –ë–£–î–£–¢ –†–ê–ë–û–¢–ê–¢–¨** –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ!

### **–ü–æ—á–µ–º—É HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω:**
- –ë—Ä–∞—É–∑–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç WebRTC –Ω–∞ HTTP (–∫—Ä–æ–º–µ localhost)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è getUserMedia() API

### **–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω TURN:**
- –û–±—Ö–æ–¥ NAT/Firewall –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö
- –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–≥–¥–∞ STUN –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º.